@page "{id:int?}"
@model BookWise.Web.Pages.BookDetailsModel
@{
    var book = Model.Book;
    var hasMyRemarks = book.MyRemarks.Any();
    var hasCommunityRemarks = book.CommunityRemarks.Any();
    var hasQuote = book.QuoteOrNull is not null;
}

<div class="book-detail">
    <nav class="book-detail-breadcrumbs" aria-label="Breadcrumb">
        <a class="breadcrumb-link" asp-page="/Index">My Books</a>
        <span class="breadcrumb-separator" aria-hidden="true">/</span>
        <span class="breadcrumb-current">@book.Title</span>
    </nav>

    <div class="book-detail-grid">
        <aside class="book-detail-sidebar">
            <div class="book-hero-card">
                <div class="book-hero-cover">
                    <img src="@Url.ResolveCoverImage(book.CoverImageUrl)"
                         alt="Cover of @book.Title"
                         loading="lazy" />
                </div>
                <div class="book-hero-meta">
                    <h1 class="book-hero-title">@book.Title</h1>
                    <p class="book-hero-author">by @book.Author</p>
                    <div class="book-hero-tags" role="list">
                        <span class="status-pill status-pill--@book.StatusToken" role="listitem">@book.StatusDisplay</span>
                        <span class="rating-chip @(book.HasPersonalRating ? string.Empty : "rating-chip--empty")" role="listitem" aria-label="My rating @(book.HasPersonalRating ? book.PersonalRatingDisplay : "not set")">
                            <span class="rating-chip-label">My rating</span>
                            <span class="rating-chip-value">@book.PersonalRatingDisplay</span>
                            <span class="rating-chip-scale">/5</span>
                        </span>
                        <span class="rating-chip rating-chip--public @(book.HasPublicRating ? string.Empty : "rating-chip--empty")" role="listitem" aria-label="Community rating @(book.HasPublicRating ? book.PublicRatingDisplay : "not available")">
                            <span class="rating-chip-label">Community</span>
                            <span class="rating-chip-value">@book.PublicRatingDisplay</span>
                            <span class="rating-chip-scale">/5</span>
                        </span>
                        <span class="favorite-chip @(book.IsFavorite ? "favorite-chip--active" : string.Empty)" role="listitem">
                            <span class="favorite-icon" aria-hidden="true"></span>
                            @(book.IsFavorite ? "Favorite" : "Not favorite")
                        </span>
                    </div>
                </div>

                <dl class="book-primary-facts">
                    <div class="book-primary-fact">
                        <dt>Category</dt>
                        <dd>@book.CategoryOrPlaceholder</dd>
                    </div>
                    <div class="book-primary-fact">
                        <dt>ISBN</dt>
                        <dd>@book.ISBNDisplay</dd>
                    </div>
                    <div class="book-primary-fact">
                        <dt>Added</dt>
                        <dd>@book.CreatedAtDisplay</dd>
                    </div>
                    <div class="book-primary-fact">
                        <dt>Updated</dt>
                        <dd>@book.UpdatedAtDisplay</dd>
                    </div>
                </dl>
            </div>
        </aside>

        <section class="book-detail-content">
            <section class="book-panel book-panel--overview">
                <header class="book-panel-header">
                    <h2>Overview</h2>
                </header>
                <p class="book-description">@book.DescriptionOrPlaceholder</p>
            </section>

            <section class="book-panel book-panel--library">
                <header class="book-panel-header">
                    <h2>Library Record</h2>
                </header>
                <dl class="book-facts book-facts--library">
                    <div class="book-fact">
                        <dt>Status</dt>
                        <dd>
                            <span class="status-pill status-pill--@book.StatusToken">@book.StatusDisplay</span>
                        </dd>
                    </div>
                    <div class="book-fact">
                        <dt>Favorite</dt>
                        <dd>
                            <span class="favorite-flag @(book.IsFavorite ? "favorite-flag--yes" : string.Empty)">
                                @(book.IsFavorite ? "Yes" : "No")
                            </span>
                        </dd>
                    </div>
                    <div class="book-fact book-fact--rating">
                        <dt>My Rating</dt>
                        <dd>
                            @if (book.HasPersonalRating)
                            {
                                <div class="rating-meter" role="img" aria-label="My rating @book.PersonalRatingDisplay out of 5">
                                    <div class="rating-meter-fill" style="width: @book.PersonalRatingPercent%"></div>
                                </div>
                                <span class="rating-meter-value">@book.PersonalRatingDisplay<span class="rating-meter-scale">/5</span></span>
                            }
                            else
                            {
                                <span class="rating-empty">Not yet rated</span>
                            }
                        </dd>
                    </div>
                    <div class="book-fact book-fact--rating">
                        <dt>Community Rating</dt>
                        <dd>
                            @if (book.HasPublicRating)
                            {
                                <div class="rating-meter" role="img" aria-label="Community rating @book.PublicRatingDisplay out of 5">
                                    <div class="rating-meter-fill" style="width: @book.PublicRatingPercent%"></div>
                                </div>
                                <span class="rating-meter-value">@book.PublicRatingDisplay<span class="rating-meter-scale">/5</span></span>
                            }
                            else
                            {
                                <span class="rating-empty">Not available</span>
                            }
                        </dd>
                    </div>
                </dl>
            </section>

            @if (hasQuote)
            {
                <section class="book-panel book-panel--quote">
                    <header class="book-panel-header">
                        <h2>Featured Quote</h2>
                    </header>
                    <figure class="quote-feature">
                        <blockquote class="quote-feature-text">“@book.QuoteOrNull”</blockquote>
                        <figcaption class="quote-feature-meta">— @book.Author</figcaption>
                    </figure>
                </section>
            }

            <section class="book-panel">
                <header class="book-panel-header">
                    <h2>My Remarks</h2>
                    <button class="panel-action" type="button">
                        <span class="panel-action-icon panel-action-icon--edit" aria-hidden="true"></span>
                        Edit Remarks
                    </button>
                </header>

                <div class="remark-list">
                    @if (hasMyRemarks)
                    {
                        foreach (var remark in book.MyRemarks)
                        {
                            <article class="remark-card">
                                <header class="remark-header">
                                    <div class="remark-icon" aria-hidden="true"></div>
                                    <div class="remark-meta">
                                        <h3 class="remark-title">@remark.Title</h3>
                                        <p class="remark-date">Added on @remark.AddedOn.ToString("MMMM d, yyyy")</p>
                                    </div>
                                </header>
                                <p class="remark-body">@remark.Content</p>
                            </article>
                        }
                    }
                    else
                    {
                        <p class="remark-empty">You haven't added any personal remarks yet.</p>
                    }
                </div>
            </section>

            <section class="book-panel">
                <header class="book-panel-header">
                    <h2>Community Remarks</h2>
                </header>

                <div class="remark-list">
                    @if (hasCommunityRemarks)
                    {
                        foreach (var remark in book.CommunityRemarks)
                        {
                            <article class="remark-card">
                                <header class="remark-header">
                                    <div class="remark-icon remark-icon--community" aria-hidden="true"></div>
                                    <div class="remark-meta">
                                        <h3 class="remark-title">@remark.Title</h3>
                                        <p class="remark-date">Added on @remark.AddedOn.ToString("MMMM d, yyyy")</p>
                                    </div>
                                </header>
                                <p class="remark-body">@remark.Content</p>
                            </article>
                        }
                    }
                    else
                    {
                        <p class="remark-empty">No community remarks recorded.</p>
                    }
                </div>
            </section>
        </section>
    </div>
</div>
